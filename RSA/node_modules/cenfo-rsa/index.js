var util = require('cenfo-util');
var p = 29;
var q = 23;

//var p = 656692050181897513638241554199181923922955921760928836766304161790553989228223793461834703506872747071705167995972707253940099469869516422893633357693;
//var q = 204616454475328391399619135615615385636808455963116802820729927402260635621645177248364272093977747839601125961863785073671961509749189348777945177811;


var n = util.n(p,q);
var me = 3;


function encriptar(mensaje){
  var mLetra;
  var mAcum ="";
  var e =  util.e(me,p,q);

  for (i = 0; i < mensaje.length; i++) {
    mLetra = util.Conv_Ascci(mensaje[i]);
    mAcum = mAcum + mLetra;
  }

  var y = (util.square(mAcum,e))%(n);

console.log ("Esto es E: "+e);
console.log ("Esto es Acum: "+mAcum);
console.log ("Esto es Y: "+ y );
console.log ("Esto es Z: "+ util.z(p,q));
console.log ("Esto es N: "+ n +"\n");
console.log ("Esto es D: "+ util.d(e,p,q));
//C = M^E mod N

  // [y = x^e mod n]
  //  var y = Math.mod(Math.pow(mensaje,e),n);

  return y;
}
function desencriptar(codificado){
    var d = util.d(me,p,q);
    var mChar;
    var mAcum;
    var k = (util.square(codificado,d) % n );
    console.log("esto es k " + k);

    /*var arrText = k.Match(/.{1,4}/g);

    arrText.forEach(function(conjunto) {
      mChar = util.Conv_Char(conjunto);
      mAcum += mChar;
    });*/

    //[z = y^d mod n]
    //var z = Math.mod(Math.pow(codificado,d),n);

    return mAcum;
}

  exports.encriptar=encriptar;
  exports.desencriptar=desencriptar;
